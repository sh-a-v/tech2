(function(){"use strict";var app;app=angular.module("engineerium",["ui.router","ngResource","ngTouch","user"]),app.config(function($stateProvider,$locationProvider,$resourceProvider){$stateProvider.state("index",{url:"/",title:"Engineerium"}).state("cabinet",{url:"/cabinet",title:"Кабинет"}).state("catalog",{url:"/catalog",title:"Каталог"}).state("search",{url:"/search",title:"Поиск"}),$locationProvider.html5Mode({enabled:!0,requireBase:!1}),$resourceProvider.defaults.stripTrailingSlashes=!0}),app.urls={api:"http://api.engineerium.io:1337"},app.controller("AppContainerCtrl",function(){}),app.directive("appContainer",function(){return{restrict:"EA",controller:"AppContainerCtrl",link:function(){}}}),app.controller("HeaderControlsCtrl",function(){}),app.directive("HeaderControls",function(){return{restrict:"E",controller:"HeaderControlsCtrl",link:function(){}}}),app.controller("PopupCtrl",function($rootScope,$scope){this.active=!1,this.activate=function(){return this.active=!0,this._broadcastPopupActivated()},this.deactivate=function(){return this.active=!1,this._broadcastPopupDeactivated()},this.stopPropagation=function($event){return $event.stopPropagation(),$event.preventDefault()},this.isActive=function(){return this.active},this._broadcastPopupActivated=function(){return $scope.$broadcast("popup:activated")},this._broadcastPopupDeactivated=function(){return $scope.$broadcast("popup:deactivated")}}),app.directive("popup",function(){return{restrict:"EA",controller:"PopupCtrl",controllerAs:"popup",scope:{},transclude:!0,templateUrl:"general/popup.html",link:function($scope,el){var show;show=function(){return console.log("el",el)},$scope.$on("popup:activated",function(){return show()})}}}),app.controller("MenuCtrl",function(){}),app.directive("menu",function(){return{restrict:"EA",controller:"MenuCtrl",scope:{},link:function(){}}}),app.user=angular.module("user",[]),app.user.controller("UserAuthCtrl",function(){return this.activate=function(){return console.log("yeeeeee")}}),app.user.directive("userAuth",function(){return{restrict:"EA",require:"^popup",controller:"UserAuthCtrl",controllerAs:"userAuthCtrl",link:function($scope,el,attrs,popupCtrl){$scope.$on("user:authActivate",function(){return function(){return popupCtrl.activate()}}(this))}}}),app.user.directive("userControl",function(){return{restrict:"EA",controller:"UserCtrl",controllerAs:"userCtrl",templateUrl:"user/user-control.html",link:function(){}}}),app.user.controller("UserProfileCtrl",function(){}),app.user.directive("userProfile",function(){return{restrict:"EA",require:"^popup",controller:"UserProfileCtrl",controllerAs:"userProfileCtrl",link:function($scope,el,attrs,popupCtrl){$scope.$on("user:profileActivate",function(){return function(){return popupCtrl.activate()}}(this))}}}),app.user.controller("UserCtrl",function($rootScope,$scope,userService){return this.initialize=function(){return this.setEventListeners(),userService.checkAuthentication()},this.setEventListeners=function(){return $rootScope.$on("user:activate",this.activate)},this.activate=function(){return userService.isAuthenticated()?this._broadcastUserProfileActivate():this._broadcastUserAuthActivate()},this._broadcastUserAuthActivate=function(){return $scope.$broadcast("user:authActivate")},this._broadcastUserProfileActivate=function(){return $scope.$broadcast("user:profileActivate")},this.initialize()}),app.user.factory("authResource",function($resource){return $resource(app.urls.api+"/auth/",null,{update:{method:"PUT"}})}),app.user.service("userService",function($rootScope,authResource){return{user:{authentication:!1},updateUser:function(user){return this.user=angular.extend(user,this.user)},authenticate:function(){return authResource.save().$promise.then(function(_this){return function(res){return res.success&&_this.updateUser(res.user),res}}(this))},deauthenticate:function(){return this.user.authentication=!1},checkAuthentication:function(){return authResource.get().$promise.then(function(_this){return function(res){return res.success&&_this.updateUser(res.user),res}}(this))},isAuthenticated:function(){return this.user.authentication}}})}).call(this);