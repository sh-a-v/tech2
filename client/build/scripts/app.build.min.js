(function(){"use strict";var app;app=angular.module("engineerium",["ui.router","ngResource","ngTouch","user","filter"]),app.config(function($stateProvider,$locationProvider,$resourceProvider){$stateProvider.state("index",{url:"/",title:"Engineerium"}).state("cabinet",{url:"/cabinet",title:"Кабинет"}).state("catalog",{url:"/catalog",title:"Каталог"}).state("search",{url:"/search",title:"Поиск"}),$locationProvider.html5Mode({enabled:!0,requireBase:!1}),$resourceProvider.defaults.stripTrailingSlashes=!0}),app.urls={api:"http://api.engineerium.io:1337"},app.controller("AppContainerCtrl",function(){return this.initialize=function(){return this.setEventListeners()},this.setEventListeners=function(){},this.initialize()}),app.directive("appContainer",function(){return{restrict:"EA",controller:"AppContainerCtrl",controllerAs:"app",link:function(){}}}),app.controller("AppSizeCtrl",function($rootScope,$scope,$window,appSizeService){return this.initialize=function(){return this.setEventListeners(),this.resize()},this.setEventListeners=function(){return angular.element($window).on("resize",function(_this){return function(){return _this.resize()}}(this))},this.resize=function(){return appSizeService.updateSize($window.innerWidth,$window.innerHeight),this._broadcastAppResized()},this._broadcastAppResized=function(){return $rootScope.$broadcast("app:resized")},this.initialize()}),app.directive("appSize",function(){return{restrict:"A",controller:"AppSizeCtrl",controllerAs:"appSize",link:function(){}}}),app.service("appSizeService",function(){return{minDesktopWidth:1025,minTabletWidth:600,maxTabletWidth:1024,minPhoneWidth:0,maxPhoneWidth:599,size:{width:0,height:0},updateSize:function(width,height){return this.size.width=width,this.size.height=height},getSize:function(){return this.size},isDesktop:function(){return this.size.width>=this.minDesktopWidth},isTablet:function(){return this.size.width>=this.minTabletWidth&&this.size.width<=this.maxTabletWidth},isPhone:function(){return this.size.width<=this.maxPhoneWidth}}}),app.controller("HeaderControlsCtrl",function($rootScope,$scope,$timeout,appSizeService){return this.visible=!1,this.collapsed=!1,this.initialize=function(){return this.setEventListeners(),this.setCollapsed(),this.activate()},this.setEventListeners=function(){return $rootScope.$on("app:resized",function(_this){return function(){return _this.setCollapsed(!0)}}(this))},this.setCollapsed=function(resize){return this.collapsed=appSizeService.isPhone(),resize?$scope.$apply():void 0},this.activate=function(){return $timeout(function(_this){return function(){return _this.visible=!0}}(this),400)},this.expand=function(){return this.isExpanded()?void 0:this.collapsed=!1},this.collapse=function(){return this.isCollapsed()?void 0:this.collapsed=!0},this.isVisible=function(){return this.visible},this.isExpanded=function(){return!this.collapsed},this.isCollapsed=function(){return this.collapsed},this._broadcastHeaderControlsExpanded=function(){return $scope.$broadcast("headerControls:expanded")},this._broadcastHeaderControlsCollapsed=function(){return $scope.$broadcast("headerControls:collapsed")},this._broadcastHeaderControlsReady=function(){return $scope.$broadcast("headerControls:ready")},this.initialize()}),app.directive("headerControls",function(){return{restrict:"E",controller:"HeaderControlsCtrl",controllerAs:"headerControls",link:function($scope,el){var collapse,expand,show;return $scope.$on("headerControls:ready",show),$scope.$on("headerControls:expanded",expand),$scope.$on("headerControls:collapsed",collapse),expand=function(){return el.removeClass("collapsed")},collapse=function(){return el.addClass("collapsed")},show=function(){return el.addClass("visible")}}}}),app.directive("header",function(){return{restrict:"EA",link:function(){}}}),app.controller("MenuCtrl",function(){}),app.directive("menu",function(){return{restrict:"EA",controller:"MenuCtrl",scope:{},link:function(){}}}),app.controller("PopupCtrl",function($rootScope,$scope){this.active=!1,this.activate=function(){return this.active=!0,this._broadcastPopupActivated()},this.deactivate=function(){return this.active=!1,this._broadcastPopupDeactivated()},this.stopPropagation=function($event){return $event.stopPropagation(),$event.preventDefault()},this.isActive=function(){return this.active},this._broadcastPopupActivated=function(){return $scope.$broadcast("popup:activated")},this._broadcastPopupDeactivated=function(){return $scope.$broadcast("popup:deactivated")}}),app.directive("popup",function(){return{restrict:"EA",controller:"PopupCtrl",controllerAs:"popup",scope:{},transclude:!0,templateUrl:"general/popup.html",link:function($scope,el){var show;show=function(){return console.log("el",el)},$scope.$on("popup:activated",show)}}}),app.filter=angular.module("filter",[]),app.user=angular.module("user",[]),app.filter.directive("filterControl",function(){return{restrict:"EA",controller:"FilterCtrl",controllerAs:"filter",link:function(){}}}),app.filter.directive("filterGenres",function(){return{restrict:"EA",require:"^popup",link:function(){}}}),app.filter.controller("FilterCtrl",function(){return this.initialize=function(){return this.setEventListeners()},this.setEventListeners=function(){},this.activate=function(){},this.initialize()}),app.user.directive("userAuth",function(){return{restrict:"EA",require:"^popup",link:function($scope,el,attrs,popupCtrl){$scope.$on("user:authActivate",function(){return function(){return popupCtrl.activate()}}(this))}}}),app.user.directive("userControl",function(){return{restrict:"EA",controller:"UserCtrl",controllerAs:"user",link:function(){}}}),app.user.directive("userProfile",function(){return{restrict:"EA",require:"^popup",link:function($scope,el,attrs,popupCtrl){$scope.$on("user:profileActivate",function(){return function(){return popupCtrl.activate()}}(this))}}}),app.user.controller("UserCtrl",function($rootScope,$scope,userService){return this.initialize=function(){return this.setEventListeners(),userService.checkAuthentication()},this.setEventListeners=function(){return $rootScope.$on("user:activate",this.activate)},this.activate=function(){return userService.isAuthenticated()?this._broadcastUserProfileActivate():this._broadcastUserAuthActivate()},this._broadcastUserAuthActivate=function(){return $scope.$broadcast("user:authActivate")},this._broadcastUserProfileActivate=function(){return $scope.$broadcast("user:profileActivate")},this.initialize()}),app.user.factory("authResource",function($resource){return $resource(app.urls.api+"/auth/",null,{update:{method:"PUT"}})}),app.user.service("userService",function($rootScope,authResource){return{user:{authentication:!1},updateUser:function(user){return this.user=angular.extend(user,this.user)},authenticate:function(){return authResource.save().$promise.then(function(_this){return function(res){return res.success&&_this.updateUser(res.user),res}}(this))},deauthenticate:function(){return this.user.authentication=!1},checkAuthentication:function(){return authResource.get().$promise.then(function(_this){return function(res){return res.success&&_this.updateUser(res.user),res}}(this))},isAuthenticated:function(){return this.user.authentication}}})}).call(this);