(function(){"use strict";var t;t=angular.module("engineerium",["ui.router","ngResource","ngTouch","user","filter"]),t.config(function(t,e,i,n){t.state("index",{url:"/",title:"Engineerium"}).state("cabinet",{url:"/cabinet",title:"Кабинет"}).state("catalog",{url:"/catalog",title:"Каталог"}).state("search",{url:"/search",title:"Поиск"}),e.html5Mode({enabled:!0,requireBase:!1}),i.defaults.stripTrailingSlashes=!0,n.interceptors.push("requestsInterceptor")}),t.urls={api:"/api"},t.controller("AppContainerCtrl",function(){return this.initialize=function(){return this.setEventListeners()},this.setEventListeners=function(){},this.initialize()}),t.directive("appContainer",function(){return{restrict:"EA",controller:"AppContainerCtrl",controllerAs:"app",link:function(){}}}),t.controller("AppSizeCtrl",function(t,e,i,n){return this.initialize=function(){return this.setEventListeners(),this.resize()},this.setEventListeners=function(){return angular.element(i).on("resize",function(t){return function(){return t.resize()}}(this))},this.resize=function(){return n.updateSize(i.innerWidth,i.innerHeight),this._broadcastAppResized()},this._broadcastAppResized=function(){return t.$broadcast("app:resized")},this.initialize()}),t.directive("appSize",function(){return{restrict:"A",controller:"AppSizeCtrl",controllerAs:"appSize",link:function(){}}}),t.service("appSizeService",function(){return{minDesktopWidth:1025,minTabletWidth:600,maxTabletWidth:1024,minPhoneWidth:0,maxPhoneWidth:599,size:{width:0,height:0},updateSize:function(t,e){return this.size.width=t,this.size.height=e},getSize:function(){return this.size},isDesktop:function(){return this.size.width>=this.minDesktopWidth},isTablet:function(){return this.size.width>=this.minTabletWidth&&this.size.width<=this.maxTabletWidth},isPhone:function(){return this.size.width<=this.maxPhoneWidth}}}),t.controller("HeaderControlsCtrl",function(t,e,i,n){return this.visible=!0,this.collapsed=n.isPhone(),this.initialize=function(){return this.setEventListeners()},this.setEventListeners=function(){return t.$on("app:resized",function(t){return function(){return n.isPhone()?t.collapse(!0):t.expand()}}(this))},this.expand=function(){this.isExpanded()||(this.collapsed=!1,this.view.expand())},this.collapse=function(t){if(!this.isCollapsed()){this.collapsed=!0,this.view.collapse();try{t&&e.$apply()}catch(i){}}},this.isVisible=function(){return this.visible},this.isExpanded=function(){return!this.collapsed},this.isCollapsed=function(){return this.collapsed},this._broadcastHeaderControlsExpanded=function(){return t.$broadcast("headerControls:expanded")},this._broadcastHeaderControlsCollapsed=function(){return t.$broadcast("headerControls:collapsed")},this.initialize()}),t.directive("headerControls",function(){return{restrict:"E",controller:"HeaderControlsCtrl",controllerAs:"headerControls",link:function(t,e,i,n){return n.view={expand:function(){return e.hasClass("collapsed")?e.removeClass("collapsed").addClass("expanded"):void 0},collapse:function(){return e.hasClass("expanded")?e.removeClass("expanded").addClass("collapsed"):void 0},hide:function(){return e.addClass("invisible")}}}}}),t.directive("header",function(){return{restrict:"EA",link:function(){}}}),t.controller("MenuCtrl",function(t,e,i){return this.collapsed=!i.isDesktop(),this.initialize=function(){return this.setEventListeners()},this.setEventListeners=function(){return t.$on("app:resized",function(t){return function(){return i.isDesktop()?t.expand():t.collapse()}}(this))},this.toggle=function(){return i.isDesktop()?void 0:this.isCollapsed()?this.expand():this.collapse()},this.expand=function(){return this.isExpanded()?void 0:(this.collapsed=!1,this.broadcastMenuExpanded(),this.view.show())},this.collapse=function(){return this.isCollapsed()?void 0:(this.collapsed=!0,this.broadcastMenuCollapsed(),this.view.hide())},this.isExpanded=function(){return!this.collapsed},this.isCollapsed=function(){return this.collapsed},this.broadcastMenuExpanded=function(){return t.$broadcast("menu:expanded")},this.broadcastMenuCollapsed=function(){return t.$broadcast("menu:collapsed")},this.initialize()}),t.directive("menu",function(){return{restrict:"EA",controller:"MenuCtrl",controllerAs:"menu",link:function(t,e,i,n){var r;return r=e.find("li"),n.view={show:function(){var t,i,n,s,o,u,c;for(s={left:0},n={duration:150,display:"block",easing:"easy-in"},r.css("left","-100%"),Velocity(e,s,n),c=[],t=o=0,u=r.length;u>o;t=++o)i=r[t],c.push(Velocity(i,s,{duration:150+80*t,easing:"easy-in"}));return c},hide:function(){var t,i;return i={left:"-200px"},t={duration:300,display:"none",easing:"easy-out"},Velocity(e,i,t)}}}}}),t.controller("LoadingCtrl",function(t){return this.requestsCount=0,this.initialize=function(){return this.setEventListeners()},this.setEventListeners=function(){return t.$on("server:request",function(t){return function(){return t.addRequest()}}(this)),t.$on("server:response",function(t){return function(){return t.removeRequest()}}(this))},this.addRequest=function(){return this.requestsCount+=1},this.removeRequest=function(){return this.requestsCount-=1},this.isOneRequest=function(){return 1===this.requestsCount},this.isThereRequests=function(){return this.requestsCount},this.initialize()}),t.directive("loading",function(){return{restrict:"A",controller:"LoadingCtrl",controllerAs:"loading",link:function(){}}}),t.controller("PopupCtrl",function(t){this.active=!1,this.activate=function(){return this.active=!0,this.view.show(),this.broadcastPopupActivated()},this.deactivate=function(){return this.active=!1,this.view.hide(),this.broadcastPopupDeactivated()},this.stopPropagation=function(t){return t.stopPropagation(),t.preventDefault()},this.isActive=function(){return this.active},this.broadcastPopupActivated=function(){return t.$broadcast("popup:activated")},this.broadcastPopupDeactivated=function(){return t.$broadcast("popup:deactivated")}}),t.directive("popup",function(){return{restrict:"EA",controller:"PopupCtrl",controllerAs:"popup",scope:{},transclude:!0,templateUrl:"general/popup.html",link:function(t,e,i,n){var r,s;return s=e.children(),r=angular.element(s[0].getElementsByClassName("popup-content")[0]),n.view={show:function(){return Velocity(r,{scaleY:.1},{duration:1}),Velocity(r,{scaleY:1},{duration:250,begin:function(){return Velocity(e,{opacity:1},{duration:80,display:"block"})}})},hide:function(){return Velocity(r,{scaleY:0},{duration:200,complete:function(){return Velocity(e,{opacity:0},{duration:50,display:"none"})}})}}}}}),t.filter=angular.module("filter",[]),t.user=angular.module("user",[]),t.filter.directive("filterControl",function(){return{restrict:"EA",controller:"FilterCtrl",controllerAs:"filter",link:function(){}}}),t.filter.directive("filterGenres",function(){return{restrict:"EA",require:"^popup",link:function(){}}}),t.filter.controller("FilterCtrl",function(){return this.initialize=function(){return this.setEventListeners()},this.setEventListeners=function(){},this.activate=function(){},this.initialize()}),t.factory("requestsInterceptor",function(t,e){var i,n;return n={broadcastServerRequest:function(){return t.$emit("server:request")},broadcastServerResponse:function(){return t.$emit("server:response")},broadcastServerError:function(){return t.$emit("server:error")}},i={request:function(t){return n.broadcastServerRequest(),t},response:function(t){return n.broadcastServerResponse(),t},responseError:function(t){return n.broadcastServerResponse(),n.broadcastServerError(),e.reject(t)}}}),t.user.directive("userAuth",function(){return{restrict:"EA",require:"^popup",link:function(t,e,i,n){t.$on("user:authActivate",function(){return function(){return n.activate()}}(this))}}}),t.user.directive("userControl",function(){return{restrict:"EA",controller:"UserCtrl",controllerAs:"user",link:function(){}}}),t.user.directive("userProfile",function(){return{restrict:"EA",require:"^popup",link:function(t,e,i,n){t.$on("user:profileActivate",function(){return function(){return n.activate()}}(this))}}}),t.user.controller("UserCtrl",function(t,e,i){return this.initialize=function(){return this.setEventListeners(),i.checkAuthentication()},this.setEventListeners=function(){return t.$on("user:activate",this.activate)},this.activate=function(){return i.isAuthenticated()?this._broadcastUserProfileActivate():this._broadcastUserAuthActivate()},this._broadcastUserAuthActivate=function(){return e.$broadcast("user:authActivate")},this._broadcastUserProfileActivate=function(){return e.$broadcast("user:profileActivate")},this.initialize()}),t.user.factory("authResource",function(e){return e(t.urls.api+"/auth/",null,{update:{method:"PUT"}})}),t.user.service("userService",function(t,e){return{user:{authentication:!1},updateUser:function(t){return this.user=angular.extend(t,this.user)},authenticate:function(){return e.save().$promise.then(function(t){return function(e){return e.success&&t.updateUser(e.user),e}}(this))},deauthenticate:function(){return this.user.authentication=!1},checkAuthentication:function(){return e.get().$promise.then(function(t){return function(e){return e.success&&t.updateUser(e.user),e}}(this))},isAuthenticated:function(){return this.user.authentication}}})}).call(this);